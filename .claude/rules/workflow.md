# 用户指令处理流程

## Todo处理

详见 `todo-workflow.md`

## 知识检索

详见 `knowledge-retrieval.md`

## 添加知识

详见 `knowledge-add.md`

## 记录检索

详见 `record-retrieval.md`

## 文档/笔记处理

### 指令识别

用户说以下内容时触发：
- "我今天写了文章，内容在 {路径}"
- "我记录了 {内容}，在 {路径}"
- "有个笔记在 {路径}"

### 处理步骤

#### 1. 读取内容
使用 Read 工具读取指定路径的文件

#### 2. 判断类型

| 类型 | 存储位置 |
|------|----------|
| 可复用知识（技术文档、代码笔记、解决方案） | `knowledge/` |
| 操作记录 | `active/` |

#### 3. 存储

- **可复用知识** → `knowledge/{主题}/{文件名}.md`
- **操作记录** → `active/YYYY-MM-DD.md`

#### 4. 更新操作记录（批量，可选）

**维护计数器**（会话内全局计数）：

1. 将操作追加到缓存文件 `active/.pending-ops`
2. 计数器 +1
3. **当计数器 = 10 时**：
   - 调用 `log-operation` agent 批量写入
   - 清空缓存
   - 重置计数器

**缓存文件格式** (`active/.pending-ops`)：
```markdown
## {操作简述}
- **类型**：写文章/整理笔记/添加知识
- **内容**：{标题/描述}
- **位置**：{路径}
- **来源**：{原始路径}
- **时间**：HH:MM
---
```
